@using PrideLink.Shared.FreindFinderDetails

<div class="card mb-4 shadow-sm border-0 rounded-4">
    <!-- Header -->
    <div class="card-header bg-light d-flex justify-content-between align-items-center rounded-top-4">
        <h3 class="mb-0">@finderAccount.UserAccountGeneralInfo.DisplayName</h3>

        <div class="d-flex align-items-center" style="gap: 10px;">
            @if (userAllowedToVerify && finderAccount.UserAccountGeneralInfo.UserVerified == "Unverified" && pageName == "FreindFinder")
            {
                <span class="badge bg-secondary text-dark"
                      style="cursor: pointer;"
                      @onclick="() => OnShowVerifyPopupClicked.InvokeAsync(finderAccount.userNo)">
                    @finderAccount.UserAccountGeneralInfo.UserVerified
                </span>
            }
            else
            {
                <span class="badge bg-info text-light">
                    @finderAccount.UserAccountGeneralInfo.UserVerified
                </span>
            }
            <!-- Add Friend Button -->
            @if (finderAccount.UserAccountGeneralInfo.FriendStatus == "Accepted")
            {
                <button class="btn btn-outline-primary btn-sm"
                        @onclick="() => OnUnfriendClicked.InvokeAsync(finderAccount.userNo)">
                    <i class="bi bi-person-plus"></i> Unfriend
                </button>
            }
            else
            {
                if (pageName == "Friends")
                {
                    if (finderAccount.UserAccountGeneralInfo.FriendStatus == "Accepted")
                    {
                        <button class="btn btn-outline-primary btn-sm"
                                @onclick="() => OnUnfriendClicked.InvokeAsync(finderAccount.userNo)">
                            <i class="bi bi-person-plus"></i> Unfriend
                        </button>
                    }
                    else
                    {
                        <button class="btn btn-outline-primary btn-sm"
                                @onclick="() => OnConfirmFriendClicked.InvokeAsync(finderAccount.userNo)">
                            <i class="bi bi-person-plus"></i> Confirm
                        </button>
                    }
                    
                }
                else
                {
                    if(finderAccount.UserAccountGeneralInfo.FriendStatus == "Pending")
                    {
                        <button class="btn btn-outline-primary disabled btn-sm">
                            <i class="bi bi-person-plus"></i> Pending
                        </button>
                    }
                    else if (finderAccount.UserAccountGeneralInfo.FriendStatus == "Accepted")
                    {
                        <button class="btn btn-outline-primary btn-sm"
                                @onclick="() => OnUnfriendClicked.InvokeAsync(finderAccount.userNo)">
                            <i class="bi bi-person-plus"></i> Add Friend
                        </button>
                    }
                    else
                    {
                        <button class="btn btn-outline-primary btn-sm"
                                @onclick="() => OnAddFriendClicked.InvokeAsync(finderAccount.userNo)">
                            <i class="bi bi-person-plus"></i> Add Friend
                        </button>
                    }
                }
                
            }
        </div>
    </div>


    <!-- Profile Images -->
    <div class="scrollable-images-container d-flex flex-row overflow-auto p-2" style="gap: 10px;">
        @foreach (var base64Image in finderAccount.UserAccountPictures)
        {
            if (!string.IsNullOrEmpty(base64Image.base64Image))
            {
                <img src="@base64Image.base64Image"
                     class="rounded-3"
                     style="object-fit: cover; width: 180px; height: 180px;"
                     alt="User image" />
            }
        }
    </div>
    <div class="card-body">
        <h5 class="card-title  mb-4">Age: @finderAccount.UserAccountGeneralInfo.Age</h5>

        <!-- About Me -->

        <h4 class="fw-semibold">About me</h4>
        <div class="p-3 border rounded-3 bg-light">
            <p class="mb-0">@finderAccount.UserAccountGeneralInfo.BioDescription</p>
        </div>
    </div>
    <!-- Accordion -->
    <div class="accordion" id="accordion_@finderAccount.userNo">
        <!-- Hobbies -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingHobbies_@finderAccount.userNo">
                <button class="accordion-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapseHobbies_@finderAccount.userNo"
                        aria-expanded="false"
                        aria-controls="collapseHobbies_@finderAccount.userNo">
                    Hobbies
                </button>
            </h2>
            <div id="collapseHobbies_@finderAccount.userNo"
                 class="accordion-collapse collapse"
                 aria-labelledby="headingHobbies_@finderAccount.userNo"
                 data-bs-parent="#accordion_@finderAccount.userNo">
                <div class="accordion-body">
                    @foreach (var hobby in finderAccount.UserAccountHobbies)
                    {
                        <button class="btn btn-primary rounded-pill me-2 mt-2" disabled>
                            @hobby.HobbyName
                        </button>
                    }
                </div>
            </div>
        </div>

        <!-- Socials -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingSocials_@finderAccount.userNo">
                <button class="accordion-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapseSocials_@finderAccount.userNo"
                        aria-expanded="false"
                        aria-controls="collapseSocials_@finderAccount.userNo">
                    Socials
                </button>
            </h2>
            <div id="collapseSocials_@finderAccount.userNo"
                 class="accordion-collapse collapse"
                 aria-labelledby="headingSocials_@finderAccount.userNo"
                 data-bs-parent="#accordion_@finderAccount.userNo">
                <div class="accordion-body">
                    @if (finderAccount.UserAccountGeneralInfo.FriendStatus != "Accepted")
                    {
                        <label class="form-label mt-3">This user is not currently your friend.</label>
                        <label class="form-label mt-3">Add this user as a friend to view there social links</label>
                    }
                    else
                    {
                        @code {
                            private Dictionary<string, (string Url, string? Value)> GetSocials(UserFreindFinderAccount finderAccount)
                            {
                                return new()
                                {
                                    ["Instagram"] = ("https://instagram.com/", finderAccount.UserAccountSocials.FirstOrDefault(e => e.socialTypeNo == 1)?.socialValue),
                                    ["Snapchat"] = ("https://snapchat.com/add/", finderAccount.UserAccountSocials.FirstOrDefault(e => e.socialTypeNo == 2)?.socialValue),
                                    ["WhatsApp"] = ("https://wa.me/", finderAccount.UserAccountSocials.FirstOrDefault(e => e.socialTypeNo == 3)?.socialValue),
                                    ["Discord"] = ("https://discordapp.com/users/", finderAccount.UserAccountSocials.FirstOrDefault(e => e.socialTypeNo == 4)?.socialValue)
                                };
                            }
                        }

                        @foreach (var social in GetSocials(finderAccount))
                        {
                            <label class="form-label mt-3">@social.Key</label>

                            @if (!string.IsNullOrWhiteSpace(social.Value.Value))
                            {
                                <a href="@($"{social.Value.Url}{social.Value.Value}")"
                                   target="_blank"
                                   class="form-control text-primary">
                                    @social.Value.Value
                                </a>
                            }
                            else
                            {
                                <p class="form-text text-muted">No @social.Key linked</p>
                            }
                        }
                    } 
                </div>
            </div>
        </div>
    </div>
</div>
@code {
    [Parameter] public UserFreindFinderAccount finderAccount { get; set; } = default!;
    [Parameter] public bool userAllowedToVerify { get; set; }
    [Parameter] public string pageName { get; set; }
    [Parameter] public EventCallback<int> OnShowVerifyPopupClicked { get; set; }
    [Parameter] public EventCallback<int> OnUnfriendClicked { get; set; }
    [Parameter] public EventCallback<int> OnConfirmFriendClicked { get; set; }
    [Parameter] public EventCallback<int> OnAddFriendClicked { get; set; }
}
