@page "/incidentmap"
@using PrideLink.Client.Internal_Models;
@using System.Text.Json;
@inject IJSRuntime JS

<h3>HeatMap</h3>
<div id="map" style="width:100%; height:500px;"></div>

@code {
    private List<HeatmapPoint> heatmapData;

    protected override void OnInitialized()
    {
        heatmapData = new List<HeatmapPoint>
        {
            new HeatmapPoint { Longitude = 1.212912, Latitude = 52.687276, Intensity = 0.7, Description = "Test1" },
        };
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var jsonData = JsonSerializer.Serialize(heatmapData);
        if (firstRender)
        {
            // initialize map and pass initial data
            await JS.InvokeVoidAsync("initializeMap", jsonData);
        }
        else
        {
            // update existing map data on subsequent renders
            await JS.InvokeVoidAsync("updateHeatmap", jsonData);
        }
    }

    // call this when data changes (e.g., after removing points)
    private async Task RefreshHeatmapAsync()
    {
        var jsonData = JsonSerializer.Serialize(heatmapData);
        await JS.InvokeVoidAsync("updateHeatmap", jsonData);
    }
}