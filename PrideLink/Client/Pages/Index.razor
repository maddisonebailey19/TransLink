@page "/"
@using PrideLink.Client.Helpers;
@using PrideLink.Shared.LoginDetails;
@inject jwtHelper _jwtHelper
@inject NavigationManager _navigationManager
@inject HttpClient _Http

<style>
    .image-button {
        background-color: rgba(255, 255, 255, 0);
        background-image: url('Alarm.png'); /* Replace with your image path */
        background-size: cover; /* Scale the image to cover the button */
        background-repeat: no-repeat; /* Prevent repeating */
        border: none; /* No border */
        width: 150px; /* Set the width of the button */
        height: 150px; /* Set the height of the button */
        cursor: pointer; /* Pointer cursor on hover */
        outline: none; /* Remove the outline when clicked */
        padding: 0; /* Remove padding */
        display: inline-block; /* Allows setting dimensions */
    }
</style>

<PageTitle>Index</PageTitle>

<div class="container mt-4">
    <h2 class="mb-4 text-center">🌈 TransLink News & Updates</h2>

    @if (NewsItems == null || NewsItems.Count == 0)
    {
        <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> No news updates available right now.
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 g-4">
            @foreach (var item in NewsItems)
            {
                <div class="col">
                    <div class="card shadow-sm h-100 border-0">
                        <div class="card-body">
                            <h5 class="card-title">@item.Title</h5>
                            <p class="card-text text-muted small mb-2">
                                <i class="bi bi-calendar3"></i>
                                @item.DatePosted.ToString("MMMM dd, yyyy")
                                @if (!string.IsNullOrEmpty(item.Category))
                                {
                                    <span class="badge bg-secondary ms-2">@item.Category</span>
                                }
                            </p>
                            <p class="card-text">@item.Content</p>
                        </div>

                        @if (!string.IsNullOrEmpty(item.Link))
                        {
                            <div class="card-footer bg-transparent border-0">
                                <a href="@item.Link" target="_blank" class="btn btn-primary btn-sm">
                                    Read more
                                </a>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    }
</div>

@code{
    private List<NewsItem> NewsItems = new();

    protected override async Task OnInitializedAsync()
    {
        var response = await _Http.GetAsync("api/Login/IsUserLoggedIn");
        if (!response.IsSuccessStatusCode)
        {
            _navigationManager.NavigateTo("/login");
        }

        // Later you can fetch from DB or API
        NewsItems = new List<NewsItem>
        {
            new() {
                Title = "Community Safety Update",
                DatePosted = DateTime.Now.AddDays(-2),
                Category = "Safety",
                Content = "We’ve added a new safety alert button to help you report incidents faster. Thank you for helping make TransLink safer!",
                Link = "https://example.com/update1"
            },
            new() {
                Title = "Norwich Trans Meetups Now Live!",
                DatePosted = DateTime.Now.AddDays(-5),
                Category = "Community",
                Content = "Join weekly meetups in Norwich — connect, share experiences, and support each other.",
                Link = "https://example.com/meetups"
            },
            new() {
                Title = "Map Improvements",
                DatePosted = DateTime.Now.AddDays(-10),
                Category = "Feature",
                Content = "We’ve improved the Norwich map to show safer walking routes and recent reports more clearly."
            }
        };
    }
    
    private class NewsItem
    {
        public string Title { get; set; } = string.Empty;
        public DateTime DatePosted { get; set; }
        public string Content { get; set; } = string.Empty;
        public string? Category { get; set; }
        public string? Link { get; set; }
    }
}